Hierarchy looks like this:

SYSADMIN
 â””â”€â”€ SNOW_D_ADMIN (owns DB)
      â”œâ”€â”€ SNOW_D_READ (account-level role)
      â”‚    â””â”€â”€ SNOW_D_RAW.DB_R (DB role: read-only)
      â”œâ”€â”€ SNOW_D_WRITE
      â”‚    â””â”€â”€ SNOW_D_RAW.DB_W
      â””â”€â”€ SNOW_D_DEPLOY
           â””â”€â”€ SNOW_D_RAW.DB_C


Account Level
â”‚
â”œâ”€â”€ Accountadmin (top)
â”‚   â””â”€â”€ Sysadmin
â”‚        â””â”€â”€ SNOW_D_ADMIN (Delegated Admin)
â”‚             â”œâ”€â”€ SNOW_D_DEPLOY
â”‚             â”‚    â””â”€â”€ SNOW_D_RAW.DB_C
â”‚             â”œâ”€â”€ SNOW_D_WRITE
â”‚             â”‚    â””â”€â”€ SNOW_D_RAW.DB_W
â”‚             â””â”€â”€ SNOW_D_READ
â”‚                  â””â”€â”€ SNOW_D_RAW.DB_R
â”‚
â””â”€â”€ Database: SNOW_D_RAW
     â”œâ”€â”€ DB Roles: DB_R, DB_W, DB_C
     â””â”€â”€ Ownership: SNOW_D_ADMIN


ðŸ§© 1. Derive Names Dynamically
ðŸ§© 2. SYSADMIN Creates the Database
ðŸ§© 3. Delegated Admin Creates Database Roles
Switch to that Admin role:
Then create database-level roles inside the new DB:
These are internal roles specific to this DB
Grant DB roles to higher-level functional roles
Links database roles â†’ to account-level functional roles

ðŸ§© 4. Review What Was Created


===
ðŸ§© Summary hierarchy (simplified)

| Level    | Role          | Purpose                      | Inherits      |
| -------- | ------------- | ---------------------------- | ------------- |
| Database | DB_C          | Full create control          | DB_W          |
| Database | DB_W          | Write (insert/update/delete) | DB_R          |
| Database | DB_R          | Read-only access             | â€”             |
| Schema   | SC_C_<schema> | Create tables/views/etc.     | SC_W_<schema> |
| Schema   | SC_W_<schema> | Write data                   | SC_R_<schema> |
| Schema   | SC_R_<schema> | Read-only                    | â€”             |




USE ROLE ACCOUNTADMIN;

ALTER USER OPENFLOW_USER SET DEFAULT_ROLE = OPENFLOW_ADMIN;
ALTER USER OPENFLOW_USER SET DEFAULT_SECONDARY_ROLES = ('ALL');

call SYSTEM$BEHAVIOR_CHANGE_BUNDLE_STATUS('2025_06');
 
call SYSTEM$ENABLE_BEHAVIOR_CHANGE_BUNDLE('2025_06');
 
 
 
 
 
 Step 1: 
 
 USE ROLE ACCOUNTADMIN;

CREATE ROLE IF NOT EXISTS OPENFLOW_ADMIN;

GRANT CREATE ROLE ON ACCOUNT TO ROLE OPENFLOW_ADMIN;

GRANT CREATE OPENFLOW DATA PLANE INTEGRATION ON ACCOUNT
   TO ROLE OPENFLOW_ADMIN;

GRANT CREATE OPENFLOW RUNTIME INTEGRATION ON ACCOUNT
   TO ROLE OPENFLOW_ADMIN;
   
 step 2: 
 
 USE ROLE ACCOUNTADMIN;
GRANT ROLE OPENFLOW_ADMIN TO USER <OPENFLOW_USER>;
ALTER USER <OPENFLOW_USER> SET DEFAULT_ROLE = OPENFLOW_ADMIN;
ALTER USER <OPENFLOW_USER> SET DEFAULT_SECONDARY_ROLES = ('ALL');


Step 3:

USE ROLE ACCOUNTADMIN;

CREATE DATABASE IF NOT EXISTS OPENFLOW;
USE OPENFLOW;
CREATE SCHEMA IF NOT EXISTS OPENFLOW;
USE SCHEMA OPENFLOW;
CREATE IMAGE REPOSITORY IF NOT EXISTS OPENFLOW;

GRANT USAGE ON DATABASE OPENFLOW TO ROLE PUBLIC;
GRANT USAGE ON SCHEMA OPENFLOW TO ROLE PUBLIC;
GRANT READ ON IMAGE REPOSITORY OPENFLOW.OPENFLOW.OPENFLOW TO ROLE PUBLIC;


Step 4:

call SYSTEM$BEHAVIOR_CHANGE_BUNDLE_STATUS('2025_06');
call SYSTEM$ENABLE_BEHAVIOR_CHANGE_BUNDLE('2025_06');


USE ROLE ACCOUNTADMIN;
ALTER USER <OPENFLOW_USER> SET DEFAULT_SECONDARY_ROLES = ('ALL');

GRANT ROLE OPENFLOW_ADMIN TO USER <OPENFLOW_USER>;

CREATE IMAGE REPOSITORY IF NOT EXISTS OPENFLOW;
GRANT USAGE ON DATABASE OPENFLOW TO ROLE PUBLIC;
GRANT USAGE ON SCHEMA OPENFLOW TO ROLE PUBLIC;
GRANT READ ON IMAGE REPOSITORY OPENFLOW.OPENFLOW.OPENFLOW TO ROLE PUBLIC;

